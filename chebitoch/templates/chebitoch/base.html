{% load static %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary Meta Tags -->
    <meta name="title" content="{% block page_title %}Chebitoch - Personal Blog{% endblock %}">
    <meta name="description" content="{% block meta_description %}Exploring technology, sharing stories, and documenting the journey through development and life.{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}web development, technology, programming, Django, blog{% endblock %}">
    <meta name="author" content="Eliphaz Chebitoch">
    <meta name="robots" content="index, follow">

    <!-- Canonical URL -->
    <link rel="canonical" href="{% block canonical_url %}{{ request.build_absolute_uri }}{% endblock %}">

    <title>{% block title %}Chebitoch - Personal Blog{% endblock %}</title>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:title" content="{% block og_title %}Chebitoch - Personal Blog{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Exploring technology, sharing stories, and documenting the journey through development and life.{% endblock %}">
    <meta property="og:image" content="{% block og_image %}https://chebitoch-blog.s3.amazonaws.com/static/images/og-default.jpg{% endblock %}">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ request.build_absolute_uri }}">
    <meta property="twitter:title" content="{% block twitter_title %}Chebitoch - Personal Blog{% endblock %}">
    <meta property="twitter:description" content="{% block twitter_description %}Exploring technology, sharing stories, and documenting the journey through development and life.{% endblock %}">
    <meta property="twitter:image" content="{% block twitter_image %}https://chebitoch-blog.s3.amazonaws.com/static/images/og-default.jpg{% endblock %}">
    <meta name="twitter:creator" content="@lord_apprentice">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon-16x16.png' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'apple-touch-icon.png' %}">

    <!-- Preconnect to external domains for faster loading -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">

    <!-- DNS Prefetch -->
    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">

    <!-- Stylesheets -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" media="print" onload="this.media='all'">

    <!-- Alpine.js - defer for better performance -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

    <!-- Schema.org Structured Data -->
    {% block structured_data %}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Blog",
        "name": "Chebitoch",
        "description": "Exploring technology, sharing stories, and documenting the journey through development and life.",
        "url": "{{ request.scheme }}://{{ request.get_host }}",
        "author": {
            "@type": "Person",
            "name": "Eliphaz Chebitoch"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Chebitoch",
            "logo": {
                "@type": "ImageObject",
                "url": "{{ request.scheme }}://{{ request.get_host }}{% static 'logo.png' %}"
            }
        }
    }
    </script>
    {% endblock %}

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        h1, h2, h3, h4 { font-family: 'Plus Jakarta Sans', sans-serif; }
        .prose p { font-family: 'Lora', serif; font-size: 1.125rem; }

        /* Scroll Progress Bar */
        #progress-container {
            width: 100%;
            height: 4px;
            background: transparent;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 100;
        }
        #progress-bar {
            height: 4px;
            background: linear-gradient(90deg, #7c3aed, #db2777);
            width: 0%;
            transition: width 0.1s;
        }

        /* Image lazy loading placeholder */
        img[loading="lazy"] {
            background: #f1f5f9;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col relative">

    <div id="progress-container"><div id="progress-bar"></div></div>

    <nav class="fixed w-full z-50 transition-all duration-300 bg-white/80 backdrop-blur-xl border-b border-white/20"
         x-data="{ atTop: true, mobileOpen: false, searchOpen: false }"
         :class="{ 'shadow-sm': !atTop }"
         @scroll.window="atTop = (window.pageYOffset > 20) ? false : true"
         role="navigation"
         aria-label="Main navigation">

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center space-x-3 group cursor-pointer">
                    <div class="w-10 h-10 bg-gradient-to-tr from-violet-600 to-fuchsia-600 rounded-xl flex items-center justify-center shadow-lg group-hover:rotate-12 transition-transform duration-300">
                        <span class="text-white font-bold text-xl">C</span>
                    </div>
                    <a href="{% url 'home' %}" class="text-2xl font-bold tracking-tight text-slate-800 group-hover:text-violet-600 transition-colors">Chebitoch</a>
                </div>

                <div class="hidden md:flex items-center space-x-8">
                    <div class="relative flex items-center" @click.outside="searchOpen = false">
                        <form action="{% url 'search' %}" method="get" class="flex items-center" role="search">
                            <input x-show="searchOpen" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 w-0" x-transition:enter-end="opacity-100 w-64" x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100 w-64" x-transition:leave-end="opacity-0 w-0"
                                   type="text" name="q" placeholder="Search articles..." aria-label="Search"
                                   class="bg-slate-100 border-none rounded-full py-2 px-4 focus:ring-2 focus:ring-violet-500 text-sm outline-none mr-2">

                            <button type="button" @click="searchOpen = !searchOpen; if(searchOpen) $nextTick(() => $el.previousElementSibling.focus())" class="text-slate-500 hover:text-violet-600 transition-colors p-2" aria-label="Toggle search">
                                <i class="fas fa-search text-lg"></i>
                            </button>
                        </form>
                    </div>

                    <a href="{% url 'home' %}" class="text-sm font-semibold text-slate-600 hover:text-violet-600 transition-colors">Home</a>

                    <div class="relative group" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                        <button class="text-sm font-semibold text-slate-600 hover:text-violet-600 flex items-center gap-1 py-2" aria-expanded="false" aria-haspopup="true">
                            Categories
                            <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div x-show="open" x-transition class="absolute left-1/2 -translate-x-1/2 mt-0 w-56 bg-white rounded-2xl shadow-xl border border-slate-100 p-2 transform origin-top">
                            {% for category in categories %}
                            <a href="{% url 'category_posts' category.slug %}" class="block px-4 py-2.5 text-sm text-slate-600 hover:bg-violet-50 hover:text-violet-700 rounded-xl transition-colors">
                                {{ category.name }}
                            </a>
                            {% endfor %}
                        </div>
                    </div>

                    <a href="{% url 'about' %}" class="text-sm font-semibold text-slate-600 hover:text-violet-600 transition-colors">About</a>
                </div>

                <div class="md:hidden">
                    <button @click="mobileOpen = !mobileOpen" class="p-2 text-slate-600 hover:bg-slate-100 rounded-lg" aria-label="Toggle mobile menu">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <div x-show="mobileOpen" x-collapse class="md:hidden bg-white border-t border-slate-100 shadow-xl px-4 py-4 space-y-4">
            <form action="{% url 'search' %}" method="get" class="relative" role="search">
                <input type="text" name="q" placeholder="Search..." aria-label="Search" class="w-full bg-slate-100 rounded-lg py-2 px-4 focus:ring-2 focus:ring-violet-500 outline-none">
                <button type="submit" class="absolute right-3 top-2.5 text-slate-400" aria-label="Submit search"><i class="fas fa-search"></i></button>
            </form>
            <a href="{% url 'home' %}" class="block text-slate-700 font-medium">Home</a>
            <div class="space-y-2 pl-4 border-l-2 border-slate-100">
                <p class="text-xs font-bold text-slate-400 uppercase">Categories</p>
                {% for category in categories %}
                <a href="{% url 'category_posts' category.slug %}" class="block text-slate-600 text-sm">{{ category.name }}</a>
                {% endfor %}
            </div>
            <a href="{% url 'about' %}" class="block text-slate-700 font-medium">About</a>
        </div>
    </nav>

    <main class="flex-grow pt-20">
        {% if messages %}
        <div class="max-w-7xl mx-auto px-4 mt-6">
            {% for message in messages %}
            <div class="bg-emerald-50 text-emerald-700 px-4 py-3 rounded-xl border border-emerald-100 flex items-center shadow-sm mb-4" role="alert">
                <i class="fas fa-check-circle mr-2"></i>
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        {% block content %}{% endblock %}
    </main>

    <footer class="bg-slate-900 text-slate-300 pt-16 pb-8 mt-24">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-12">
                <div class="col-span-1 md:col-span-2">
                    <h3 class="text-2xl font-bold text-white mb-4">Chebitoch.</h3>
                    <p class="text-slate-400 leading-relaxed max-w-sm">
                        Exploring ideas, sharing stories, and documenting the journey through technology and life.
                    </p>
                </div>
                <div>
                    <h4 class="text-white font-semibold mb-4">Explore</h4>
                    <ul class="space-y-2">
                        <li><a href="{% url 'home' %}" class="hover:text-violet-400 transition-colors">Home</a></li>
                        <li><a href="{% url 'about' %}" class="hover:text-violet-400 transition-colors">About Me</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-white font-semibold mb-4">Connect</h4>
                    <div class="flex space-x-4">
                        <a href="https://x.com/lord_apprentice" target="_blank" rel="noopener noreferrer" aria-label="Follow on X (Twitter)" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center hover:bg-violet-600 hover:text-white transition-all hover:-translate-y-1">
                            <i class="fab fa-x-twitter"></i>
                        </a>
                        <a href="https://www.instagram.com/_.apprentice/" target="_blank" rel="noopener noreferrer" aria-label="Follow on Instagram" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center hover:bg-pink-600 hover:text-white transition-all hover:-translate-y-1">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="border-t border-slate-800 pt-8 flex justify-between text-sm text-slate-500">
                <p>&copy; 2025 Chebitoch. All rights reserved.</p>
                <p>Built with Django</p>
            </div>
        </div>
    </footer>

    <button id="backToTop" class="fixed bottom-8 right-8 bg-slate-900 text-white w-12 h-12 rounded-full shadow-2xl flex items-center justify-center opacity-0 translate-y-10 transition-all duration-300 z-40 hover:bg-violet-600" aria-label="Back to top">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script>
        // Debounced scroll handler for better performance
        let scrollTimeout;
        window.addEventListener('scroll', function() {
            if (scrollTimeout) clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(function() {
                let winScroll = document.body.scrollTop || document.documentElement.scrollTop;
                let height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                let scrolled = (winScroll / height) * 100;
                document.getElementById("progress-bar").style.width = scrolled + "%";

                const btn = document.getElementById("backToTop");
                if (document.documentElement.scrollTop > 300) {
                    btn.classList.remove('opacity-0', 'translate-y-10');
                } else {
                    btn.classList.add('opacity-0', 'translate-y-10');
                }
            }, 10);
        }, { passive: true });

        document.getElementById("backToTop").onclick = function() {
            window.scrollTo({top: 0, behavior: 'smooth'});
        };
    </script>
</body>
</html>